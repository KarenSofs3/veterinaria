<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vet MiauGuau - Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <style>
        :root {
            --purple-main: purple;
            --bg-soft: #fff0ff;
        }
        body { background-color: var(--bg-soft); font-family: 'Segoe UI', sans-serif; }
        .header, .footer, .modal-header { background: var(--purple-main) !important; color: white; }
        .card { border-radius: 12px; border: none; box-shadow: 0 4px 10px rgba(0,0,0,0.05); transition: 0.3s; }
        .card:hover { transform: translateY(-3px); }
        .cita-card { border-left: 5px solid var(--purple-main); }
        .cita-card.terminada { border-left-color: #28a745; }
        .cita-card.anulada { border-left-color: #dc3545; }
        .animal-gif { width: 80%; height: 150px; object-fit: contain; border-radius: 8px; align-self: center; margin-top: 10px; }
        .estado-badge { padding: 4px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: bold; }
        .filter-btn.active { background: var(--purple-main); color: white; }
        .btn-purple { background: var(--purple-main); border: none; color:white; }
        .btn-purple:hover { background:  var(--purple-main); color: white; }
    </style>
</head>
<body>

    <header class="header py-3 mb-4 shadow-sm">
        <div class="container d-flex justify-content-between align-items-center">
            <h1><i class="bi bi-paw"></i> VET MiauGuau</h1>
            <button class="btn btn-light fw-bold" id="btnNuevaCita"><i class="bi bi-plus-lg"></i> Nueva Cita</button>
        </div>
    </header>

    <main class="container">
        <div class="card mb-4">
            <div class="card-body">
                <div class="filter-buttons d-flex gap-2">
                    <button class="btn btn-outline-primary filter-btn active" data-estado="todas">Todas</button>
                    <button class="btn btn-outline-primary filter-btn" data-estado="abierta">Abiertas</button>
                    <button class="btn btn-outline-success filter-btn" data-estado="terminada">Terminadas</button>
                    <button class="btn btn-outline-danger filter-btn" data-estado="anulada">Anuladas</button>
                </div>
            </div>
        </div>

        <div id="listaCitas" class="row g-3"></div>
    </main>

    <div class="modal fade" id="modalCita" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header"><h5>Datos de la Cita</h5><button class="btn-close btn-close-white" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <form id="formCita">
                        <input type="hidden" id="citaId">
                        <div class="mb-3 text-center" id="gifPreview"></div>
                        <div class="row">
                            <div class="col-md-6 mb-2">
                                <label class="form-label">Mascota</label>
                                <input type="text" class="form-control" id="nombreMascota" required>
                            </div>
                            <div class="col-md-6 mb-2">
                                <label class="form-label">Tipo</label>
                                <select class="form-control" id="tipoMascota" required>
                                    <option value="">Seleccione...</option>
                                    <option value="Perro">Perro</option>
                                    <option value="Gato">Gato</option>
                                    <option value="Conejo">Conejo</option>
                                    <option value="Ave">Ave</option>
                                    <option value="Hamster">Hamster</option>
                                    <option value="huron">Huron</option>
                                    <option value="reptiles">Reptiles</option>
                                    <option value="caballo">Caballo</option>
                                    <option value="tortuga">Tortuga</option>
                                    <option value="cerdo">Cerdo</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-2">
                                <label class="form-label">Fecha</label>
                                <input type="date" class="form-control" id="fechaCita" required>
                            </div>
                            <div class="col-md-6 mb-2">
                                <label class="form-label">Hora</label>
                                <input class="form-control" type="time" id="horaCita" required></input>
                            </div>
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Propietario</label>
                            <input type="text" class="form-control" id="nombrePropietario" required>
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Síntomas</label>
                            <textarea class="form-control" id="sintomas" rows="2" required></textarea>
                        </div>
                        <div id="estadoContainer" style="display:none">
                            <label class="form-label">Estado</label>
                            <select class="form-select" id="estadoCita">
                                <option value="abierta">Abierta</option>
                                <option value="terminada">Terminada</option>
                                <option value="anulada">Anulada</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    <button class="btn btn-purple" id="btnGuardarCita">Guardar Cita</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let citas = JSON.parse(localStorage.getItem('citas')) || [];
        const modal = new bootstrap.Modal(document.getElementById('modalCita'));

        const gifs = {
            'Perro': 'https://www.gifsanimados.org/data/media/202/perro-imagen-animada-0387.gif',
            'Gato': 'https://www.gifsanimados.org/data/media/209/gato-imagen-animada-0072.gif',
            'Conejo': 'https://www.gifsanimados.org/data/media/327/conejo-imagen-animada-0087.gif',
            'Ave': 'https://www.gifsanimados.org/data/media/230/pajaro-y-ave-imagen-animada-0598.gif',
            'Hamster': 'https://www.gifsanimados.org/data/media/517/hamster-imagen-animada-0149.gif',
            'huron': 'https://www.gifsanimados.org/data/media/497/huron-imagen-animada-0008.gif',
            'reptiles': 'https://www.gifsanimados.org/data/media/290/serpiente-y-culebra-imagen-animada-0006.gif',
            'caballo': 'https://www.gifsanimados.org/data/media/217/caballo-imagen-animada-0291.gif',
            'tortuga': 'https://www.gifsanimados.org/data/media/289/tortuga-imagen-animada-0021.gif',
            'cerdo': 'https://www.gifsanimados.org/data/media/293/cerdo-puerco-y-cochino-imagen-animada-0032.gif'
        };

        document.getElementById('btnNuevaCita').onclick = () => {
            document.getElementById('formCita').reset();
            document.getElementById('citaId').value = '';
            document.getElementById('estadoContainer').style.display = 'none';
            document.getElementById('gifPreview').innerHTML = '';
            generarHoras();
            modal.show();
        };

        document.getElementById('tipoMascota').onchange = (e) => {
            const val = e.target.value;
            document.getElementById('gifPreview').innerHTML = val ? `<img src="${gifs[val]}" class="animal-gif shadow-sm">` : '';
        };

        document.getElementById('fechaCita').onchange = () => generarHoras();

        function generarHoras() {
            const select = document.getElementById('horaCita');
            const fecha = document.getElementById('fechaCita').value;
            select.innerHTML = '<option value="">Seleccione hora...</option>';
            for(let h=8; h<=18; h++) {
                const horaStr = `${h}:00`;
                const ocupado = citas.some(c => c.fecha === fecha && c.hora === horaStr && c.id != document.getElementById('citaId').value);
                if(!ocupado) select.innerHTML += `<option value="${horaStr}">${h}:00 ${h<12?'AM':'PM'}</option>`;
            }
        }

        document.getElementById('btnGuardarCita').onclick = () => {
            const id = document.getElementById('citaId').value || Date.now();
            const nueva = {
                id,
                nombreMascota: document.getElementById('nombreMascota').value,
                tipoMascota: document.getElementById('tipoMascota').value,
                fecha: document.getElementById('fechaCita').value,
                hora: document.getElementById('horaCita').value,
                nombrePropietario: document.getElementById('nombrePropietario').value,
                sintomas: document.getElementById('sintomas').value,
                estado: document.getElementById('estadoCita').value || 'abierta'
            };

            if(!nueva.nombreMascota || !nueva.hora) return alert("Completa los campos");
            const index = citas.findIndex(c => c.id == id);
            index > -1 ? citas[index] = nueva : citas.push(nueva);
            localStorage.setItem('citas', JSON.stringify(citas));
            modal.hide();
            render();
        };

        function render(filtro = 'todas') {
            const contenedor = document.getElementById('listaCitas');
            contenedor.innerHTML = '';
            const filtradas = citas.filter(c => filtro === 'todas' || c.estado === filtro);
            
            filtradas.forEach(c => {
                contenedor.innerHTML += `
                    <div class="col-md-4">
                        <div class="card cita-card ${c.estado} h-100">
                            <img src="${gifs[c.tipoMascota] || ''}" class="card-img-top animal-gif">
                            <div class="card-body">
                                <div class="d-flex justify-content-between">
                                    <h5 class="mb-0">${c.nombreMascota}</h5>
                                    <span class="estado-badge bg-light text-dark border">${c.estado}</span>
                                </div>
                                <p class="text-muted small">${c.tipoMascota} | ${c.fecha} - ${c.hora}</p>
                                <p class="mb-2"><strong>Dueño:</strong> ${c.nombrePropietario}</p>
                                <p class="small text-truncate">${c.sintomas}</p>
                                <hr>
                                <div class="d-flex gap-2">
                                    <button class="btn btn-sm btn-outline-primary flex-grow-1" onclick="editar(${c.id})">
                                        <i class="bi bi-pencil"></i> Editar
                                    </button>
                                    <button class="btn btn-sm btn-outline-danger flex-grow-1" onclick="eliminar(${c.id})">
                                        <i class="bi bi-trash"></i> Eliminar
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>`;
            });
        }

        window.editar = (id) => {
            const c = citas.find(cita => cita.id == id);
            document.getElementById('citaId').value = c.id;
            document.getElementById('nombreMascota').value = c.nombreMascota;
            document.getElementById('tipoMascota').value = c.tipoMascota;
            document.getElementById('fechaCita').value = c.fecha;
            document.getElementById('nombrePropietario').value = c.nombrePropietario;
            document.getElementById('sintomas').value = c.sintomas;
            document.getElementById('estadoCita').value = c.estado;
            document.getElementById('estadoContainer').style.display = 'block';
            generarHoras();
            document.getElementById('horaCita').value = c.hora;
            document.getElementById('gifPreview').innerHTML = `<img src="${gifs[c.tipoMascota]}" class="animal-gif shadow-sm">`;
            modal.show();
        };

        window.eliminar = (id) => {
            if(confirm("¿Estás seguro de eliminar esta cita?")) {
                citas = citas.filter(c => c.id != id);
                localStorage.setItem('citas', JSON.stringify(citas));
                render();
            }
        };

        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.onclick = () => {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                render(btn.dataset.estado);
            };
        });

        render();
    </script>
</body>
</html>